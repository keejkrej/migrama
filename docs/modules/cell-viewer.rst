cell-viewer: Interactive Visualization
======================================

cell-viewer is an interactive PySide6-based GUI application for visualizing extracted Zarr sequences from ``migrama extract``.

Overview
--------

cell-viewer offers a user-friendly interface for:

- Interactive visualization of multi-channel timelapse data from Zarr stores
- Frame-by-frame navigation through extracted sequences
- Channel switching including cell and nuclei mask overlays
- Sequence navigation (FOV/Cell/Seq)

Launching the Application
-------------------------

Command Line
~~~~~~~~~~~~

.. code-block:: bash

   migrama viewer

Or via Python module:

.. code-block:: bash

   python -m migrama.viewer

User Interface
--------------

Main Window Layout
~~~~~~~~~~~~~~~~~~

.. code-block:: text

   +-------------------------------------------------------------+
   | Zarr Sequence Viewer                                        |
   +-------------+-----------------------------------------------+
   | Zarr Nav    |                                               |
   | [Open Zarr] |                                               |
   | [< Prev]    |            Image Display                      |
   | [Next >]    |                                               |
   | Seq 1/10    |                                               |
   | FOV: 0      |                                               |
   | Cell: 5     |                                               |
   +-------------+                                               |
   | Frame Ctrl  |                                               |
   | [---o----]  |                                               |
   | Frame: 5/20 |                                               |
   | [> Play]    |                                               |
   | Channel: v  |                                               |
   +-------------+-----------------------------------------------+
   | Status: Loaded zarr (10 sequences)                          |
   +-------------------------------------------------------------+

Key Components
~~~~~~~~~~~~~~

- **Zarr Navigation**: Open zarr stores, navigate between sequences
- **Frame Controls**: Frame slider, playback, channel selection
- **Image Display**: Current frame with grayscale or categorical colormap
- **Status Bar**: Loading status and current channel info

File Operations
---------------

Opening Zarr Stores
~~~~~~~~~~~~~~~~~~~

1. Click "Open Zarr" button
2. Select a ``.zarr`` directory created by ``migrama extract``
3. The viewer loads all sequences and displays the first one

Supported Format
~~~~~~~~~~~~~~~~

- Zarr stores generated by ``migrama extract``
- Structure: ``fov_{idx}/cell_{idx}/{seq_idx}/data`` with shape ``(T, C, H, W)``
- Labels: ``fov_{idx}/cell_{idx}/labels/{seq_idx}/nuclei_masks`` and ``cell_masks``

Navigation Controls
-------------------

Sequence Navigation
~~~~~~~~~~~~~~~~~~~

| Control      | Description                    |
| ------------ | ------------------------------ |
| **Previous** | Load previous sequence         |
| **Next**     | Load next sequence             |

Frame Navigation
~~~~~~~~~~~~~~~~

| Control          | Description                    |
| ---------------- | ------------------------------ |
| **Frame Slider** | Navigate to specific frame     |
| **Play/Pause**   | Automatic playback at 10 fps   |

Channel Selection
-----------------

The channel dropdown includes:

1. **Image channels**: ``channel_0``, ``channel_1``, etc. (grayscale display)
2. **cell_masks**: Cell segmentation masks (categorical colormap)
3. **nuclei_masks**: Nuclei segmentation masks (categorical colormap)

Masks are displayed with a tab20 colormap where background is black and each cell ID gets a distinct color.

Workflow Integration
--------------------

.. code-block:: bash

   # 1. Analyze cells to identify patterns
   migrama analyze --cells data.nd2 --output analysis.csv

   # 2. Extract sequences with segmentation
   migrama extract --cells data.nd2 --csv analysis.csv --output extracted.zarr

   # 3. View extracted sequences
   migrama viewer
   # Then open extracted.zarr through the application

API Usage
---------

.. code-block:: python

   from PySide6.QtWidgets import QApplication
   from migrama.viewer.ui.main_window import MainWindow

   app = QApplication([])
   window = MainWindow()
   window.show()
   app.exec()
